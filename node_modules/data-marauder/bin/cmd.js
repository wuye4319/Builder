const Proxy = require('../lib/proxy')
let proxy = new Proxy()
const Ctrl = require('../router/operation/ctrl')
let ctrl = new Ctrl()

const Robot = require('../lib/myrob/robot')
let robot = new Robot()
let path = require('path')
const Fsdel = require('keeper-core/lib/delete')
let del = new Fsdel()

let simgroutname = 'simagenav'
const Center = require('../lib/mining/center')
let center = new Center()
const Base64 = require('../lib/writebase64')
let base64 = new Base64()
const Pm2 = require('./pm2')
let pm2 = new Pm2()

const Answer = require('./chooseurl')
let answer = new Answer()

let cmdlist = [
  {
    name: 'clear', desc: '清理缓存文件',
    action: function () {
      let mycache = path.join(__dirname, '../../../cache/')
      del.deleteSource(mycache, 'all')
      let analysis = path.join(__dirname, '../../../analysis/')
      del.deleteSource(analysis, 'all')
    }
  }, {
    name: 'rob', desc: 'a robot to do sth for you',
    action: function () {
      robot.robot()
    }
  }, {
    name: 'start', desc: 'open chrome core and proxy', alias: 's',
    action: function () {
      pm2.start('/proxyboot.js')
    }
  }, {
    name: 'bigdata', desc: '采集数据'.red, alias: 'bd',
    action: async function () {
      answer.chooseurl()
    }
  }, {
    name: 'mining <isdownload>', desc: '分析数据'.red, alias: 'mn',
    action: function (isdownload) {
      if (isdownload) {
        center.getdata(simgroutname, isdownload)
      } else {
        center.getdata(simgroutname)
      }
    }
  }, {
    name: 'base64', desc: 'write base64 to file',
    action: function () {
      base64.tofile()
    }
  }, {
    name: 'clearprocess', desc: '清理进程', alias: 'cp',
    action: function () {
      ctrl.clearinternumb()
    }
  }, {
    name: 'ipinterval <time>', desc: '设置IP切换时间',
    action: function (time) {
      if (time) {
        proxy.setipinterval(time)
      } else {
        console.log('please enter time!')
      }
    }
  }, {
    name: 'auto-login <account>', desc: '自动登录账号', alias: 'al',
    action: function (account) {
      let tempPro = 'https://detail.tmall.com/item.htm?id=554802892200'
      // let tempPro = 'https://www.tmall.com/'
      let url = 'https://login.tmall.com/?from=sm&redirectURL='
      proxy.login(url, tempPro, account || 0)
    }
  }, {
    name: 'manualchangeip', desc: 'Close active change ip, and manual change ip by index',
    action: function () {
      proxy.manualchangeip()
    }
  }, {
    name: 'autoproxy', desc: 'Auto active change ip', alias: 'ap',
    action: function () {
      proxy.autoproxy()
    }
  }
]

module.exports = cmdlist