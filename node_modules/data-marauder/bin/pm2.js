const pm2 = require('pm2')
let path = require('path')

class proxy {
  start(script) {
    pm2.connect(function (err) {
      if (err) {
        console.error(err)
        process.exit(2)
      }

      pm2.start({
        script: path.join(__dirname, script),
      }, (err, apps) => {
        pm2.disconnect()
        if (err) { throw err }
      })
    })
  }

  isboot(boot) {
    return new Promise(resolve => {
      pm2.list((err, list) => {
        if (err) { console.log(err) } else {
          for (let i in list) {
            if (list[i].name === boot) {
              resolve(list[i].pm2_env.status)
            }
          }
        }
        resolve(false)
      })
    })
  }
}

module.exports = proxy