/**
 * Created by nero on 2017/6/2.
 */
const Process = require('../process')
let process = new Process()
const Taobao = require('../mission/taobao')
let taobao = new Taobao()
const GetDom = require('./getdom')
let getdom = new GetDom()

class ctrl {
  async getmall(ctx, rout) {
    let myurl = ctx.url.substr(rout.length + 2)
    let data = await process.filter(myurl, rout, 'pipe')

    let result = taobao.getcont(data)
    result ? ctx.response.body = result : ctx.response.body = 'Get data failed!'
  }

  async getimg(url, rout) {
    // get data by url
    let result = await process.filter(url, rout, 'pipe')
    let cache = 0
    if (cache) {
      cache.writecache(result.cont, result.url, rout)
    }

    return result
  }

  async toutiao(url, rout) {
    // get data by url
    // mobile [true || false]
    let result = await process.filter(url, rout, 'pipe', false)
    getdom.dom(result.html)

    let cache = 0
    if (cache) {
      cache.writecache(result.cont, result.url, rout)
    }

    return result
  }

  async alimam(url, rout) {
    // get data by url
    let result = await process.filter(url, rout, 'pipe')
    let cache = 0
    if (cache) {
      cache.writecache(result.cont, result.url, rout)
    }

    return result
  }
}

module.exports = ctrl
