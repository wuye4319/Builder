/**
 * Created by nero on 2017/6/2.
 */
const Proxy = require('keeper-proxy')
let proxy = new Proxy()
const Action = require('./action')
let action = new Action()
require('../operation/global')
const systemconfig = require('../../config/system')

proxy.serverlisten(systemconfig.port)
// subject
proxy.addrouter('/bigdata/simg/', async (ctx) => {
  let url = 'https://www.kongjie.space/thread-10952336-1-1.html'
  let data = await action.getimg(url, 'simagenav')
  ctx.response.body = data
})

// subject
// proxy.addrouter(/^\/taobao(?:\/|$)/, async (ctx) => {
//   await action.getmall(ctx, 'taobao')
// })

// toutiao
proxy.addrouter('/bigdata/toutiao/:id', async (ctx) => {
  let url = ctx.params.id ? "https://www.toutiao.com/" + ctx.params.id : 'http://m.toutiao.com/'
  console.log(url)
  let data = await action.toutiao(url, 'toutiao')
  ctx.response.body = data
})

// toutiao
proxy.addrouter('/robot/alimam/', async (ctx) => {
  let url = 'https://pub.alimama.com/promo/search/index.htm?spm=a219t.7900221%2F11.1998910419.4.7ca575a5BHLNCv&toPage=1&queryType=2&type=block'
  // mobile true
  let data = await action.alimam(url, 'alimam')
  ctx.response.body = data
})
